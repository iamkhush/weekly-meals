{% extends 'meals/base.html' %}
{% load meal_extras %}

{% block title %}Weekly Meal Plan - Weekly Meals{% endblock %}

{% block content %}
<div class="week-navigation" style="margin-bottom: 1rem; text-align: center;">
    <a href="{% url 'meals:weekly_meal_plan_date' previous_week_year previous_week_number %}" class="btn">&laquo; Previous Week</a>
    {% if not is_current_week %}
        <a href="{% url 'meals:weekly_meal_plan' %}" class="btn">Current Week</a>
    {% endif %}
    <a href="{% url 'meals:weekly_meal_plan_date' next_week_year next_week_number %}" class="btn">Next Week &raquo;</a>
</div>

<h2>Weekly Meal Plan</h2>
<p><strong>Week of:</strong> {{ week_start|date:"M d, Y" }}</p>

<div class="meal-grid">
    <!-- Header row -->
    <div class="meal-cell header">Meal Type</div>
    {% for day_num, day_name in days_of_week %}
        <div class="meal-cell header">{{ day_name }}</div>
    {% endfor %}
    
    <!-- Meal rows -->
    {% for meal_type, meal_type_display in meal_types %}
        <div class="meal-cell header">{{ meal_type_display }}</div>
        {% for day_num, day_name in days_of_week %}
            <div class="meal-cell">
                {% if meal_grid|lookup:day_num|lookup:meal_type %}
                    {% with entry=meal_grid|lookup:day_num|lookup:meal_type %}
                        <strong><a href="{% url 'meals:meal_detail' entry.meal.id %}" style="color: #2c3e50; text-decoration: none;">{{ entry.meal.name }}</a></strong>
                        <br><small>{{ entry.meal.total_time }}min</small>
                        {% if entry.notes %}
                            <br><small style="color: #666;">{{ entry.notes }}</small>
                        {% endif %}
                    {% endwith %}
                {% else %}
                    <em style="color: #999;">No meal planned</em>
                {% endif %}
            </div>
        {% endfor %}
    {% endfor %}
</div>

<div style="margin-top: 2rem;">
    <h3>Add a Meal to Your Plan</h3>
    <form method="post">
        {% csrf_token %}
        {{ form.as_p }}
        <button type="submit" class="btn">Add Meal</button>
    </form>
    <p class="mt-2">Don't see the meal you're looking for? <a href="{% url 'admin:meals_meal_add' %}">Create a new meal</a>.</p>
</div>

<div style="margin-top: 2rem;">
    <h3>Plan with AI</h3>
    <p>Let AI help you generate a meal plan for next week based on your past meals.</p>
    <a href="{% url 'meals:plan_with_ai' %}" class="btn">Plan with AI</a>
</div>
{% endblock %}

<!-- Template filter to lookup dictionary values -->
{% load static %}
<script>
// Custom template filter would go here, but for now we'll handle this in the view
</script>
